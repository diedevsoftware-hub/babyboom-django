{% extends "core/base.html" %}
{% load static %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'cart/css/cart.css' %}">
{% endblock styles %}

{% block content %}
<div class="container" id="cart-page-container">
    <h1 class="page-title">Tu Carrito de Compras</h1>

    {% if cart|length > 0 %}
    <div class="cart-layout">
        <!-- Columna de Items -->
        <div class="cart-items-list">
            {% csrf_token %}
            {% for item in cart %}
            <div class="cart-item" data-variant-id="{{ item.variant.id }}" data-stock="{{ item.variant.stock }}">
                <div class="cart-item-image">
                    {% if item.variant.images.first %}
                    <a href="{{ item.variant.product.get_absolute_url }}">
                        <img src="{{ item.variant.images.first.image.url }}" alt="{{ item.variant.product.name }}">
                    </a>
                    {% endif %}
                </div>
                <div class="cart-item-details">
                    <div class="item-info">
                        <a href="{{ item.variant.product.get_absolute_url }}" class="product-name">{{ item.variant.product.name }}</a>
                        <p class="variant-info">
                            Color: {{ item.variant.color_name }}
                        </p>
                        <p class="item-price">Precio unitario: S/ {{ item.price }}</p>
                    </div>
                    <div class="item-controls">
                         <div class="quantity-control">
                            <button class="quantity-btn decrease" aria-label="Disminuir cantidad">-</button>
                            <input type="number" name="quantity" value="{{ item.quantity }}" min="1" class="quantity-input" aria-label="Cantidad">
                            <button class="quantity-btn increase" aria-label="Aumentar cantidad">+</button>
                        </div>
                        <button class="remove-link" title="Eliminar producto">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="cart-item-total">
                    <p>Total: <span class="item-total-price">S/ {{ item.total_price|floatformat:2 }}</span></p>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Columna de Resumen -->
        <div class="cart-summary">
            <h3>Resumen de la Orden</h3>
            <div class="summary-line">
                <span>Subtotal</span>
                <span id="cart-subtotal">S/ {{ cart.get_total_price|floatformat:2 }}</span>
            </div>
            <div class="summary-line">
                <span>Envío</span>
                <span>Por calcular</span>
            </div>
            <div class="summary-total">
                <span>Total</span>
                <span id="cart-total">S/ {{ cart.get_total_price|floatformat:2 }}</span>
            </div>
            <a href="{% url 'cart:checkout' %}" class="checkout-button">Proceder al Pago</a>
        </div>
    </div>
    {% else %}
    <!-- ===== INICIO DEL NUEVO BLOQUE DE CARRITO VACÍO ===== -->
    <div class="cart-empty">
        <!-- Icono amigable de carrito de compras -->
        <div class="cart-empty-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
        </div>
        
        <h2>Tu carrito de compras está vacío</h2>
        <p>Parece que aún no has encontrado el juguete perfecto. ¡Explora nuestras categorías!</p>
        
        <!-- Botón de acción principal -->
        <a href="{% url 'home' %}" class="button-primary">Seguir comprando</a>
    </div>
    <!-- ===== FIN DEL NUEVO BLOQUE ===== -->
    {% endif %}
</div>

{% endblock %}

{% block scripts %}
    <script src="{% static 'cart/js/cart-detail.js' %}" type="module"></script>
{% endblock scripts %}